{{ template "header.html". }}
{{ template "navbar.html". }}
{{ template "sidebar.html". }}
<section>
  <div class="card" style="height: 800px">
    <div class="card-body">
      <input type="hidden" name="_csrf" value="{{.csrfToken}}">
      <div class="row mt-5 justify-content-center align-items-end">
        <div class="col-md-6">
          <input type="text" name="City" id="City" class="form-control" placeholder="Search by city name" required>
        </div>
        <div class="col-md-2">
          <button type="button" class="btn btn-primary w-100" id="btn-search-loc">Search</button>
        </div>
      </div>
      <div class="row mx-3 mt-1 align-items-center">
        <div class="col-md">
          <div id="preview"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!--ADD NEW LOCATION MODAL-->
<div class="modal fade" id="addNewLocationModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add New Location</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
          <div class="row mt-4">
            <div class="col-md-2 pt-2">
              <label for="CityAddNewModal" class="form-label">City</label>
            </div>
            <div class="col-md-6">
              <input type="text" name="City" id="CityAddNewModal" class="form-control" required>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col-md-2 pt-2">
              <label for="LatitudeAddNewModal" class="form-label">Latitude</label>
            </div>
            <div class="col-md-6">
              <input type="text" name="Latitude" id="LatitudeAddNewModal" class="form-control" required>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col-md-2 pt-2">
              <label for="LongitudeAddNewModal" class="form-label">Longitude</label>
            </div>
            <div class="col-md-6">
              <input type="text" name="Longitude" id="LongitudeAddNewModal" class="form-control" required>
            </div>
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" id="btn-save-loc" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
{{ template "script.html". }}
<script>
  $(document).on('click', '#btn-save-loc', function () {
    var City = $('#CityAddNewModal').val();
    var Latitude = $('#LatitudeAddNewModal').val();
    var Longitude = $('#LongitudeAddNewModal').val();
    var csrfToken = $('meta[name="csrf-token"]').attr('content');

    console.info("City: ", City);
    console.info("Latitude: ", Latitude);
    console.info("Longitude: ", Longitude);

    $.ajax({
      url: '/api/v1/location',
      type: 'post',
      dataType: 'json',
      data: {
        City: City,
        Latitude: Latitude,
        Longitude: Longitude,
        _csrf: csrfToken
      },
      success: function (res) {
        let html = '';
        console.info(res);
        console.info(res.status);
        if (res.status == 'success') {
          res.locations.forEach(loc => {
            html += `<div class="mt-3 mb-2">
                  <h5 class="card-title">${loc.city}</h5>
                  <p class="card-text">Latitude: ${loc.latitude}</p>
                  <p class="card-text">Longitude: ${loc.longitude}</p>
                  <p class="card-text">weather_summary: ${loc.weather_summary}</p>
                  <p class="card-text">temperature:     ${loc.temperature}</p>
                  <p class="card-text">wind_speed:      ${loc.wind_speed}</p>
                  <p class="card-text">wind_angle:      ${loc.wind_angle}</p>
                  <p class="card-text">wind_direction:  ${loc.wind_direction}</p>
              </div>
            `;
          });
        } else {
          html = `<h5 class="card-title text-center mt-2">Error found.</h5>
            <p class="card-text text-center">${res.message}</p>
            `;
        }

        $('#preview').empty();
        $('#preview').append(html);
      },
      error: function (xhr) {
        $('#preview').html('<div class="alert alert-danger">Terjadi kesalahan</div>');
      }
    });
  });

  $(document).on('click', '#btn-search-loc', function () {
    var city = $('#City').val();
    var csrfToken = $('meta[name="csrf-token"]').attr('content');

    // var spinner = `<div class="spinner-grow text-primary" role="status">
    //   <span class="visually-hidden">Loading...</span>
    // </div>
    // <div class="spinner-grow text-secondary" role="status">
    //   <span class="visually-hidden">Loading...</span>
    // </div>
    // <div class="spinner-grow text-success" role="status">
    //   <span class="visually-hidden">Loading...</span>
    // </div>
    // <div class="spinner-grow text-danger" role="status">
    //   <span class="visually-hidden">Loading...</span>
    // </div>
    // <div class="spinner-grow text-warning" role="status">
    //   <span class="visually-hidden">Loading...</span>
    // </div>
    // <div class="spinner-grow text-info" role="status">
    //   <span class="visually-hidden">Loading...</span>
    // </div>
    // <div class="spinner-grow text-dark" role="status">
    //   <span class="visually-hidden">Loading...</span>
    // </div>
    // `;
    //
    // $('#preview').append(spinner);

    $.ajax({
      url: '/api/v1/search-location',
      type: 'post',
      dataType: 'json',
      data: {
        city: city,
        _csrf: csrfToken
      },
      success: function (res) {
        let html = '';
        if (res.status == 'success') {
          res.locations.forEach(loc => {
            html += `
              <div class="mt-3 mb-2">
                  <h5 class="card-title">${loc.city}</h5>
                  <p class="card-text">Latitude: ${loc.latitude}</p>
                  <p class="card-text">Longitude: ${loc.longitude}</p>
                  <p class="card-text">weather_summary: ${loc.Weather.weather_summary}</p>
                  <p class="card-text">temperature:     ${loc.Weather.temperature}</p>
                  <p class="card-text">wind_speed:      ${loc.Weather.wind_speed}</p>
                  <p class="card-text">wind_angle:      ${loc.Weather.wind_angle}</p>
                  <p class="card-text">wind_direction:  ${loc.Weather.wind_direction}</p>
              </div>
            `;
          });
        } else if (res.status === 'empty') {
          html = `
            <h5 class="card-title text-center mt-2">Data not found.</h5>
            <div class="text-center">
              <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addNewLocationModal">
                Add New Location
              </button>
            </div>
          `;
        } else {
          html = `
            <h5 class="card-title text-center mt-2">Error found.</h5>
            <p class="card-text text-center">${res.message}</p>
            `;
        }

        $('#preview').empty();
        $('#preview').append(html);
      },
      error: function (xhr) {
        $('#preview').html('<div class="alert alert-danger">Terjadi kesalahan</div>');
      }
    });
  });
</script>
{{ template "footer.html". }}